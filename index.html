<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta de Materias y Horarios</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Almendra+SC&family=Bebas+Neue&family=Indie+Flower&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap"
    rel="stylesheet">
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Raleway', sans-serif;
      font-weight: 400;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      line-height: 1.6;
    }

    /* Elementos donde queremos el estilo creativo */
    header h1,
    header p,
    .card-title,
    button:not(.select-all-btn),
    .course-block,
    .list-group-item {
      font-family: 'Indie Flower', cursive;
      font-weight: 400;
    }

    /* Mejor legibilidad para contenido importante */
    h2,
    h3,
    h4,
    h5,
    h6,
    #materias-aprobadas,
    #materias-disponibles,
    #horario-section h2,
    .accordion-button,
    .form-check-label,
    .schedule-header,
    .correlativas-info,
    .prerequisitos-list {
      font-family: 'Montserrat', sans-serif;
    }

    /* Contraste para textos pequeños */
    .correlativas-info,
    .prerequisitos-list,
    .schedule-cell {
      font-size: 0.9rem;
    }

    /* Mejor jerarquía visual */
    header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    header p {
      font-size: 1.2rem;
    }

    h2 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
      color: #2c3e50;
    }

    /* Ajustes específicos para mejor legibilidad */
    .materia-item .form-check-label {
      font-weight: 500;
    }

    .prerequisito-item {
      font-size: 0.8rem;
    }


    header {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      overflow: hidden;
    }

    .logo {
      max-width: 100px;
      height: auto;
      margin-bottom: 1rem;
    }



    @media (max-width: 768px) {
      .logo {
        max-width: 100px;
      }
    }

    main {
      padding: 20px;
    }

    section {
      margin-bottom: 20px;
    }

    #checkbox-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }

    button {
      margin-top: 10px;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    ul li {
      margin: 5px 0;
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 5px;
    }

    footer {
      background-color: #c90505;
      color: white;
      padding: 20px 0;
      text-align: center;
    }

    footer .social-icons a {
      color: white;
      margin: 0 10px;
      font-size: 1.5rem;
      text-decoration: none;
    }

    footer .social-icons a:hover {
      color: #17a2b8;
    }

    /* Estilos para el horario */
    .schedule-container {
      margin-top: 20px;
    }

    .schedule {
      display: grid;
      grid-template-columns: 80px repeat(6, 1fr);
      gap: 1px;
      background-color: #ddd;
    }

    .schedule-cell {
      background-color: white;
      padding: 8px;
      min-height: 50px;
      border: 1px solid #dee2e6;
    }

    .schedule-header {
      font-weight: bold;
      text-align: center;
      background-color: #f0f0f0;
    }

    .course-block {
      background-color: #e3f2fd;
      margin: 2px;
      padding: 5px;
      border-radius: 3px;
      font-size: 12px;
      cursor: move;
    }

    .conflict {
      background-color: #ffcdd2 !important;
    }

    .schedule-controls {
      margin-bottom: 15px;
    }

    /* Estilos para el arrastre */
    .draggable-course {
      cursor: grab;
      transition: all 0.2s;
    }

    .draggable-course:active {
      cursor: grabbing;
      opacity: 0.7;
    }

    .drop-hover {
      background-color: #e8f5e9 !important;
      border: 2px dashed #4caf50 !important;
    }

    .course-delete {
      float: right;
      cursor: pointer;
      color: #dc3545;
      font-weight: bold;
      margin-left: 5px;
    }

    .correlativas-info {
      font-size: 0.8rem;
      color: #6c757d;
      margin-top: 5px;
    }

    .materia-item {
      margin-bottom: 8px;
    }

    .semestre-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .select-all-btn {
      font-size: 0.8rem;
      padding: 2px 8px;
    }

    .materia-disabled {
      opacity: 0.6;
      pointer-events: none;
    }

    .prerequisitos-list {
      list-style-type: none;
      padding-left: 15px;
      font-size: 0.8rem;
      color: #6c757d;
    }

    .prerequisito-item {
      margin-bottom: 3px;
    }

    .prerequisito-cumplido {
      color: #28a745;
    }

    .prerequisito-pendiente {
      color: #dc3545;
    }
  </style>
</head>

<body>
  <header class="text-white py-4" style="background-color: #0ca2bc">
    <h1>Consulta de Materias y Horarios</h1>
    <p>Selecciona tu carrera, las materias aprobadas y organiza tu horario semanal.</p>
  </header>

  <main class="container my-4">
    <!-- Selector de carrera -->
    <section id="seleccion-carrera" class="mb-4">
      <h2>Selecciona tu carrera</h2>
      <select id="carrera-select" class="form-select">
        <option value="" disabled selected>Elige tu carrera</option>
        <option value="mecanica">Ingeniería Mecánica</option>
        <option value="electromecanica">Ingeniería Electromecánica</option>
        <option value="mecatronica">Ingeniería Mecatrónica</option>
      </select>
    </section>

    <!-- Materias aprobadas y disponibles -->
    <section id="materias-aprobadas" style="display: none;">
      <h2>Materias Aprobadas</h2>
      <div class="accordion" id="accordionSemestres">
        <!-- Los semestres se generarán dinámicamente -->
      </div>
      <button id="check-available" class="btn btn-primary mt-3">Ver Materias Disponibles</button>
    </section>

    <section id="materias-disponibles" style="display: none;" class="mt-4">
      <h2>Materias Disponibles</h2>
      <div class="alert alert-info">
        Arrastra las materias a tu horario semanal
      </div>
      <ul id="available-list" class="list-group"></ul>
    </section>

    <!-- Sección de Horario -->
    <section id="horario-section" class="mt-5" style="display: none;">
      <h2>Organizador de Horario</h2>
      <div class="alert alert-info">
        Registra las materias disponibles a tu horario semanal y verifica que no haya choques.
      </div>

      <div class="schedule-controls">
        <button id="add-course" class="btn btn-success btn-sm">
          <i class="bi bi-plus-circle"></i> Añadir Materia Manualmente
        </button>
        <button id="check-conflicts" class="btn btn-warning btn-sm ms-2">
          <i class="bi bi-exclamation-triangle"></i> Verificar Choques
        </button>
        <button id="clear-schedule" class="btn btn-danger btn-sm ms-2">
          <i class="bi bi-trash"></i> Limpiar Horario
        </button>
        <button id="download-image" class="btn btn-light btn-sm ms-2">
          <i class="bi bi-image"></i> Descargar Imagen
        </button>
      </div>

      <div class="schedule-container">
        <div class="schedule" id="schedule">
          <!-- Horario se generará aquí -->
        </div>
      </div>

    </section>
    <!-- Sección Calculadora de Notas -->
    <section id="calculadora-notas" class="mt-5" style="display: none;">
      <h2>Calculadora de Notas</h2>
      <div class="alert alert-info">
        Configura el sistema de evaluación de cada materia para calcular qué necesitas para aprobar.
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="card mb-4">
            <div class="card-header">
              <h5>Configurar Sistema de Evaluación</h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label">Seleccionar Materia</label>
                <select id="materia-notas-select" class="form-select">
                  <option value="" disabled selected>Elige una materia</option>
                  <!-- Se llenará dinámicamente -->
                </select>
              </div>

              <div id="config-evaluacion-container">
                <!-- Configuración básica -->
                <div class="mb-3">
                  <label class="form-label">Número de Parciales</label>
                  <input type="number" id="num-parciales" class="form-control" min="1" max="4" value="2">
                </div>

                <div id="parciales-container">
                  <!-- Parciales se generarán aquí -->
                </div>

                <!-- Configuración de Final -->
                <div class="mb-3">
                  <label class="form-label">¿Incluye Examen Final?</label>
                  <select id="tiene-final" class="form-select">
                    <option value="no" selected>No</option>
                    <option value="si">Sí</option>
                    <option value="recuperatorio">Es recuperatorio</option>
                  </select>
                </div>

                <div id="final-container" style="display: none;">
                  <div class="mb-3">
                    <label class="form-label">Peso Examen Final (%)</label>
                    <input type="number" id="peso-final" class="form-control" min="0" max="100" value="30">
                  </div>
                  <div class="mb-3" id="recuperatorio-container" style="display: none;">
                    <label class="form-label">¿Recupera qué parcial?</label>
                    <select id="parcial-recupera" class="form-select">
                      <!-- Se llenará dinámicamente -->
                    </select>
                  </div>
                </div>

                <!-- Configuración de Prácticas -->
                <div class="mb-3">
                  <label class="form-label">¿Incluye Prácticas?</label>
                  <select id="tiene-practicas" class="form-select">
                    <option value="no" selected>No</option>
                    <option value="si">Sí</option>
                  </select>
                </div>

                <div id="practicas-container" style="display: none;">
                  <div class="mb-3">
                    <label class="form-label">Peso Prácticas (%)</label>
                    <input type="number" id="peso-practicas" class="form-control" min="0" max="100" value="20">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Nota Prácticas (opcional)</label>
                    <input type="number" id="nota-practicas" class="form-control" min="0" max="100"
                      placeholder="Dejar vacío si no presentado">
                  </div>
                </div>

                <!-- Configuración de Auxiliatura -->
                <div class="mb-3">
                  <label class="form-label">¿Incluye Auxiliatura?</label>
                  <select id="tiene-auxiliatura" class="form-select">
                    <option value="no" selected>No</option>
                    <option value="si">Sí</option>
                  </select>
                </div>

                <div id="auxiliatura-container" style="display: none;">
                  <div class="mb-3">
                    <label class="form-label">Peso Auxiliatura (%)</label>
                    <input type="number" id="peso-auxiliatura" class="form-control" min="0" max="100" value="10">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Nota Auxiliatura (opcional)</label>
                    <input type="number" id="nota-auxiliatura" class="form-control" min="0" max="100"
                      placeholder="Dejar vacío si no presentado">
                  </div>
                </div>

                <!-- Nota mínima para aprobar -->
                <div class="mb-3">
                  <label class="form-label">Nota Mínima para Aprobar</label>
                  <input type="number" id="nota-minima" class="form-control" min="0" max="100" value="60">
                </div>
              </div>

              <button id="btn-calcular-nota" class="btn btn-primary mt-3">
                <i class="bi bi-calculator"></i> Calcular Nota Necesaria
              </button>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5>Resultados</h5>
            </div>
            <div class="card-body">
              <div id="resultados-notas">
                <p class="text-muted">Configura el sistema de evaluación y haz clic en calcular.</p>
              </div>
              <div class="mt-3" id="detalle-calculadora">
                <!-- Detalle de cálculos -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Sección de Consejos Útiles -->
    <section id="consejos-utiles" class="mt-5">
      <h2 class="text-center">Consejos Útiles</h2>
      <div class="card-deck">
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="card-title"><i class="bi bi-journal-check"></i> Tip 0</h5>
            <p class="card-text">Puedes tomar las materias <strong>Humanística I, II, III</strong> e <strong>Ingeniería
                de Mantenimiento</strong> cuando lo creas necesario. Los créditos son solo una formalidad, ¡planifica a
              tu ritmo!</p>
          </div>
        </div>
        <div class="card-deck">
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-lightbulb"></i> Tip 1</h5>
              <p class="card-text">Asegúrate de revisar las correlativas antes de planificar tu ciclo.</p>
            </div>
          </div>
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-calendar"></i> Tip 2</h5>
              <p class="card-text">Revisa los horarios de materias para evitar choques al momento de inscribirte y
                recuerda que hay materias que puedes condicionar</p>
            </div>
          </div>
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-emoji-smile"></i> Tip 3</h5>
              <p class="card-text">Consulta con estudiantes avanzados para obtener recomendaciones sobre docentes.</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-dark text-center py-3">
    <p class="text-white">Desarrollado para estudiantes con ❤️</p>
    <p class="text-white">&copy; 2024 /mone. Todos los derechos reservados.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Plan de estudios con materias organizadas por semestre
    const planes = {
      mecanica: {
        semestres: [
          {
            semestre: "1º Semestre",
            materias: [
              { id: 1, nombre: "Cálculo I", prerequisitos: [] },
              { id: 2, nombre: "Álgebra", prerequisitos: [] },
              { id: 3, nombre: "Física Básica I", prerequisitos: [] },
              { id: 4, nombre: "Lab. Física Básica I", prerequisitos: [] },
              { id: 5, nombre: "Dibujo Mecánico", prerequisitos: [] },
              { id: 6, nombre: "Química General", prerequisitos: [] },
              { id: 7, nombre: "Lab. Química General", prerequisitos: [] },
            ],
          },
          {
            semestre: "2º Semestre",
            materias: [
              { id: 8, nombre: "Cálculo II", prerequisitos: [1] },
              { id: 9, nombre: "Álgebra Lineal", prerequisitos: [1, 2] },
              { id: 10, nombre: "Probabilidad y Estadística", prerequisitos: [1, 2] },
              { id: 11, nombre: "Métodos Numéricos y Diseño Algorítmico I", prerequisitos: [1, 2] },
              { id: 12, nombre: "Física Básica II", prerequisitos: [3, 4] },
              { id: 13, nombre: "Lab. Física Básica II", prerequisitos: [3, 4] },
              { id: 14, nombre: "Mecánica Técnica I", prerequisitos: [1, 3, 4, 5] },
            ],
          },
          {
            semestre: "3º Semestre",
            materias: [
              { id: 15, nombre: "Ecuaciones Diferenciales", prerequisitos: [8, 9, 10, 11] },
              { id: 16, nombre: "Física Básica III", prerequisitos: [8, 12, 13] },
              { id: 17, nombre: "Lab. Física Básica III", prerequisitos: [8, 12, 13] },
              { id: 18, nombre: "Termodinámica", prerequisitos: [6, 7, 12, 13] },
              { id: 19, nombre: "Ciencia de los Materiales", prerequisitos: [6, 7, 12, 13] },
              { id: 20, nombre: "Lab. Ciencia de los Materiales", prerequisitos: [6, 7, 12, 13] },
              { id: 21, nombre: "Mecánica Técnica II", prerequisitos: [14] },
              { id: 22, nombre: "Mecánica de Materiales", prerequisitos: [14] },
            ],
          },
          {
            semestre: "4º Semestre",
            materias: [
              { id: 23, nombre: "Mecánica de Materiales Aplicadas", prerequisitos: [22] },
              { id: 24, nombre: "Circuitos Eléctricos I", prerequisitos: [12, 13, 15] },
              { id: 25, nombre: "Lab. Circuitos Eléctricos I", prerequisitos: [12, 13, 15] },
              { id: 26, nombre: "Mecánica de Fluidos", prerequisitos: [6, 7, 12, 13] },
              { id: 27, nombre: "Lab. Mecánica de Fluidos", prerequisitos: [6, 7, 12, 13] },
              { id: 28, nombre: "Transmisión de Calor", prerequisitos: [18] },
              { id: 29, nombre: "Procesos de Manufactura I", prerequisitos: [19, 20, 21] },
              { id: 30, nombre: "Taller de Procesos de Manufactura I", prerequisitos: [19, 20, 21] },
              { id: 31, nombre: "Mecanismos", prerequisitos: [21] },
            ],
          },
          {
            semestre: "5º Semestre",
            materias: [
              { id: 32, nombre: "Controles Automáticos", prerequisitos: [15] },
              { id: 33, nombre: "Lab. Controles Automáticos", prerequisitos: [15] },
              { id: 34, nombre: "Máquinas Eléctricas", prerequisitos: [24, 25] },
              { id: 35, nombre: "Lab. Máquinas Eléctricas", prerequisitos: [24, 25] },
              { id: 36, nombre: "Electrónica I", prerequisitos: [24, 25] },
              { id: 37, nombre: "Lab. Electrónica I", prerequisitos: [24, 25] },
              { id: 38, nombre: "Ingeniería Térmica", prerequisitos: [28] },
              { id: 39, nombre: "Lab. Ingeniería Térmica", prerequisitos: [28] },
              { id: 40, nombre: "Elementos de Máquinas I", prerequisitos: [23, 31] },
              { id: 41, nombre: "Estructuras Metálicas", prerequisitos: [23] },
            ],
          },
          {
            semestre: "6º Semestre",
            materias: [
              { id: 42, nombre: "Instalaciones Eléctricas II", prerequisitos: [34, 35] },
              { id: 43, nombre: "Lab. Instalaciones Eléctricas II", prerequisitos: [34, 35] },
              { id: 44, nombre: "Máquinas Neumáticas", prerequisitos: [26, 27] },
              { id: 45, nombre: "Taller Máquinas Neumáticas", prerequisitos: [26, 27] },
              { id: 46, nombre: "Refrigeración y Aire Acondicionado", prerequisitos: [38, 39] },
              { id: 47, nombre: "Lab. Refrigeración y Aire Acondicionado", prerequisitos: [38, 39] },
              { id: 48, nombre: "Procesos de Manufactura II", prerequisitos: [29] },
              { id: 49, nombre: "Taller de Manufactura II", prerequisitos: [30] },
              { id: 50, nombre: "Elementos de Máquinas II", prerequisitos: [40, 41] },
            ],
          },
          {
            semestre: "7º Semestre",
            materias: [
              { id: 52, nombre: "Tecnología de Gas Natural", prerequisitos: [38, 39] },
              { id: 53, nombre: "Taller Tecnología del Gas Natural", prerequisitos: [38, 39] },
              { id: 54, nombre: "Máquinas Hidráulicas", prerequisitos: [44, 45] },
              { id: 55, nombre: "Mecatrónica I", prerequisitos: [36, 37] },
              { id: 56, nombre: "Lab. Mecatrónica I", prerequisitos: [36, 37] },
              { id: 57, nombre: "Diseño Mecánico", prerequisitos: [48, 49, 50] },
              { id: 58, nombre: "Taller de Diseño Mecánico", prerequisitos: [48, 49, 50] },
            ],
          },
          {
            semestre: "8º Semestre",
            materias: [
              { id: 61, nombre: "Diseño de Sistema de Control", prerequisitos: [32, 33] },
              { id: 62, nombre: "Lab. Diseño de Sistema de Control", prerequisitos: [32, 33] },
              { id: 63, nombre: "Energías Alternativas", prerequisitos: [52, 53] },
              { id: 66, nombre: "Máquinas de Elevación y Transporte", prerequisitos: [57, 58] },
              { id: 67, nombre: "Ingeniería Automotriz", prerequisitos: [60] },
              { id: 68, nombre: "Taller de Ingeniería Automotriz", prerequisitos: [60] },
              { id: 64, nombre: "Trabajo de Titulación", prerequisitos: [61, 62, 63, 66, 67, 68] },
            ],
          },
        ],
      },
      electromecanica: {
        semestres: [
          {
            semestre: "1º Semestre",
            materias: [
              { id: 1, nombre: "Cálculo I", prerequisitos: [] },
              { id: 2, nombre: "Álgebra", prerequisitos: [] },
              { id: 4, nombre: "Física Básica I", prerequisitos: [] },
              { id: 5, nombre: "Laboratorio de Física Básica I", prerequisitos: [] },
              { id: 6, nombre: "Química General", prerequisitos: [] },
              { id: 7, nombre: "Laboratorio de Química General", prerequisitos: [] },
              { id: 8, nombre: "Dibujo Mecánico", prerequisitos: [] },
            ],
          },
          {
            semestre: "2º Semestre",
            materias: [
              { id: 9, nombre: "Cálculo II", prerequisitos: [1] },
              { id: 10, nombre: "Álgebra Lineal", prerequisitos: [2] },
              { id: 11, nombre: "Probabilidad y Estadística", prerequisitos: [1, 2] },
              { id: 12, nombre: "Métodos Numéricos y Diseño de Algoritmos I", prerequisitos: [1, 2] },
              { id: 13, nombre: "Física Básica II", prerequisitos: [5, 6, 1] },
              { id: 14, nombre: "Laboratorio de Física Básica II", prerequisitos: [5, 6, 1] },
              { id: 15, nombre: "Mecánica Técnica I", prerequisitos: [5, 6, 8, 1] },
            ],
          },
          {
            semestre: "3º Semestre",
            materias: [
              { id: 18, nombre: "Ecuaciones diferenciales", prerequisitos: [9, 10, 11, 12] },
              { id: 21, nombre: "Física Básica III", prerequisitos: [9, 13, 14] },
              { id: 3, nombre: "Física Básica III", prerequisitos: [9, 13, 14] },
              { id: 28, nombre: "Termodinámica", prerequisitos: [13, 14, 6, 7] },
              { id: 16, nombre: "Ciencia de los Materiales", prerequisitos: [13, 14, 6, 7] },
              { id: 17, nombre: "Laboratorio de Ciencia de los Materiales", prerequisitos: [13, 14, 6, 7] },
              { id: 19, nombre: "Mecánica Técnica II", prerequisitos: [15] },
              { id: 20, nombre: "Mecánica de Materiales", prerequisitos: [15] },
            ],
          },
          {
            semestre: "4º Semestre",
            materias: [
              { id: 22, nombre: "Circuitos Eléctricos I", prerequisitos: [21, 3, 18] },
              { id: 23, nombre: "Laboratorio de Circuitos Eléctricos I", prerequisitos: [21, 3, 18] },
              { id: 24, nombre: "Medidas Eléctricas", prerequisitos: [21, 3] },
              { id: 25, nombre: "Laboratorio de Medidas Eléctricas", prerequisitos: [21, 3] },
              { id: 26, nombre: "Mecánica de Fluidos", prerequisitos: [13, 14, 6, 7] },
              { id: 27, nombre: "Laboratorio de Mecánica de Fluidos", prerequisitos: [13, 14, 6, 7] },
              { id: 41, nombre: "Transmisión de Calor", prerequisitos: [28] },
              { id: 29, nombre: "Procesos de Manufactura", prerequisitos: [16, 17, 19] },
              { id: 30, nombre: "Taller de Manufactura", prerequisitos: [16, 17, 19] },
              { id: 39, nombre: "Mecánica de materiales aplicada", prerequisitos: [20] },
            ],
          },
          {
            semestre: "5º Semestre",
            materias: [
              { id: 31, nombre: "Sistemas de Control", prerequisitos: [18] },
              { id: 32, nombre: "Laboratorio de Sistemas de Control", prerequisitos: [18] },
              { id: 33, nombre: "Circuitos Eléctricos II", prerequisitos: [22, 23, 24, 25] },
              { id: 34, nombre: "Laboratorio de Circuitos Eléctricos II", prerequisitos: [22, 23, 24, 25] },
              { id: 35, nombre: "Electrónica I", prerequisitos: [22, 23] },
              { id: 36, nombre: "Lab. Electrónica I", prerequisitos: [22, 23] },
              { id: 37, nombre: "Ingeniería Térmica", prerequisitos: [41] },
              { id: 38, nombre: "Laboratorio de Ingeniería Térmica", prerequisitos: [41] },
              { id: 40, nombre: "Elementos de Máquinas I", prerequisitos: [29, 30, 39] },
            ],
          },
          {
            semestre: "6º Semestre",
            materias: [
              { id: 43, nombre: "Máquinas de Corriente Alterna", prerequisitos: [34, 35] },
              { id: 44, nombre: "Lab. Máquinas de Corriente Alterna", prerequisitos: [35, 34] },
              { id: 46, nombre: "Máquinas Hidráulicas", prerequisitos: [26, 27] },
              { id: 47, nombre: "Máquinas Neumáticas", prerequisitos: [26, 27] },
              { id: 48, nombre: "Taller Máquinas Neumáticas", prerequisitos: [26, 27] },
              { id: 49, nombre: "Mecatrónica", prerequisitos: [37, 38] },
              { id: 50, nombre: "Lab. Mecatrónica", prerequisitos: [37, 38] },
            ],
          },
          {
            semestre: "7º Semestre",
            materias: [
              { id: 52, nombre: "Máquinas de Corriente Alterna II", prerequisitos: [44, 43] },
              { id: 53, nombre: "Lab. Máquinas de Corriente Alterna II", prerequisitos: [44, 43] },
              { id: 54, nombre: "Instalaciones Eléctricas II", prerequisitos: [44, 43] },
              { id: 55, nombre: "Lab. Instalaciones Eléctricas II", prerequisitos: [44, 43] },
              { id: 56, nombre: "Electrónica Industrial", prerequisitos: [49, 50] },
              { id: 57, nombre: "Lab. Electrónica Industrial", prerequisitos: [49, 50] },
              { id: 59, nombre: "Elementos de Máquinas II", prerequisitos: [40] },
            ],
          },
          {
            semestre: "8º Semestre",
            materias: [
              { id: 61, nombre: "Diseño de Sistema de Control", prerequisitos: [31, 32] },
              { id: 62, nombre: "Lab. Diseño de Sistema de Control", prerequisitos: [54, 55] },
              { id: 63, nombre: "Sistemas Eléctricos de Potencia", prerequisitos: [54, 55] },
              { id: 64, nombre: "Lab. Sistemas Eléctricos de Potencia", prerequisitos: [54, 55] },
              { id: 65, nombre: "Centrales Eléctricas I", prerequisitos: [52, 53, 46] },
              { id: 66, nombre: "Lab. Centrales Eléctricas I", prerequisitos: [52, 53, 46] },
              { id: 67, nombre: "Diseño Mecánico", prerequisitos: [59] },
              { id: 68, nombre: "Taller de Diseño Mecánico", prerequisitos: [59] },
              { id: 69, nombre: "TRABAJO DE TITULACIÓN", prerequisitos: [61, 62, 63, 64, 65, 66, 67, 68] },
            ],
          },
        ],
      },
      mecatronica: {
        semestres: [
          {
            semestre: "1º Semestre",
            materias: [
              { id: 1, nombre: "Cálculo I", prerequisitos: [] },
              { id: 2, nombre: "Álgebra", prerequisitos: [] },
              { id: 3, nombre: "Física Básica I", prerequisitos: [] },
              { id: 4, nombre: "Laboratorio de Física Básica I", prerequisitos: [] },
              { id: 5, nombre: "Química General", prerequisitos: [] },
              { id: 6, nombre: "Laboratorio de Química General", prerequisitos: [] },
              { id: 7, nombre: "Dibujo Técnico", prerequisitos: [] },
            ],
          },
          {
            semestre: "2º Semestre",
            materias: [
              { id: 8, nombre: "Cálculo II", prerequisitos: [1] },
              { id: 9, nombre: "Álgebra Lineal", prerequisitos: [1, 2] },
              { id: 10, nombre: "Probabilidad y Estadística", prerequisitos: [1, 2] },
              { id: 11, nombre: "Métodos Numéricos y Diseño de Algoritmos", prerequisitos: [1, 2] },
              { id: 12, nombre: "Física Básica II", prerequisitos: [3, 4] },
              { id: 13, nombre: "Laboratorio de Física Básica II", prerequisitos: [3, 4] },
              { id: 18, nombre: "Mecánica Técnica", prerequisitos: [3, 4, 7] },
            ],
          },
          {
            semestre: "3º Semestre",
            materias: [
              { id: 14, nombre: "Ecuaciones Diferenciales", prerequisitos: [8, 9, 10, 11] },
              { id: 15, nombre: "Física Básica III", prerequisitos: [12, 13, 8] },
              { id: 23, nombre: "Laboratorio de Física Básica III", prerequisitos: [12, 13, 8] },
              { id: 16, nombre: "Termodinámica", prerequisitos: [12, 13, 5, 6] },
              { id: 17, nombre: "Métodos Numéricos y Diseño de Algoritmos II", prerequisitos: [11] },
              { id: 67, nombre: "Mecánica Técnica II", prerequisitos: [18] },
              { id: 19, nombre: "Mecánica de Materiales", prerequisitos: [18] },
            ],
          },
          {
            semestre: "4º Semestre",
            materias: [
              { id: 20, nombre: "Circuitos Eléctricos I", prerequisitos: [14, 15, 23] },
              { id: 21, nombre: "Laboratorio de Circuitos Eléctricos I", prerequisitos: [14, 15, 23] },
              { id: 22, nombre: "Métodos Numéricos y Diseño de Algoritmos III", prerequisitos: [17] },
              { id: 24, nombre: "Laboratorio de Métodos Numéricos y Diseño de Algoritmos III", prerequisitos: [17] },
              { id: 25, nombre: "Mecánica de Fluidos", prerequisitos: [8, 12, 13] },
              { id: 26, nombre: "Laboratorio de Mecánica de Fluidos", prerequisitos: [8, 12, 13] },
              { id: 27, nombre: "Transmisión de Calor", prerequisitos: [16] },
              { id: 28, nombre: "Mecanismos", prerequisitos: [67] },
              { id: 29, nombre: "Elementos de Máquinas I", prerequisitos: [19] },
            ],
          },
          {
            semestre: "5º Semestre",
            materias: [
              { id: 30, nombre: "Controles Automáticos", prerequisitos: [14] },
              { id: 31, nombre: "Laboratorio de Controles Automáticos", prerequisitos: [14] },
              { id: 32, nombre: "Máquinas Eléctricas", prerequisitos: [20, 21] },
              { id: 33, nombre: "Laboratorio de Máquinas Eléctricas", prerequisitos: [20, 21] },
              { id: 34, nombre: "Electrónica I", prerequisitos: [20, 21] },
              { id: 35, nombre: "Laboratorio de Electrónica I", prerequisitos: [20, 21] },
              { id: 36, nombre: "Ingeniería Térmica", prerequisitos: [27] },
              { id: 38, nombre: "Laboratorio de Ingeniería de Térmica", prerequisitos: [27] },
              { id: 37, nombre: "Elementos de Máquinas II", prerequisitos: [28, 29] },
            ],
          },
          {
            semestre: "6º Semestre",
            materias: [
              { id: 40, nombre: "Instrumentación Electrónica Mecánica", prerequisitos: [30, 31, 32, 33] },
              { id: 41, nombre: "Lab. Instrumentación Electrónica Mecánica", prerequisitos: [30, 31, 32, 33] },
              { id: 42, nombre: "Microprocesadores y Microcontroladores", prerequisitos: [28, 34, 35] },
              { id: 43, nombre: "Lab. Microprocesadores y Microcontroladores", prerequisitos: [28, 34, 35] },
              { id: 44, nombre: "Sistemas Digitales", prerequisitos: [34, 35] },
              { id: 45, nombre: "Laboratorio Sistemas Digitales", prerequisitos: [34, 35] },
              { id: 46, nombre: "Máquinas Neumáticas", prerequisitos: [25, 26] },
              { id: 47, nombre: "Lab. Máquinas Neumáticas", prerequisitos: [25, 26] },
              { id: 48, nombre: "Procesos de Manufactura II", prerequisitos: [37] },
              { id: 49, nombre: "Taller Procesos de Manufactura II", prerequisitos: [37] },
            ],
          },
          {
            semestre: "7º Semestre",
            materias: [
              { id: 50, nombre: "Procesamiento Digital de Señales", prerequisitos: [44, 45, 40, 41] },
              { id: 51, nombre: "Lab. Procesamiento Digital de Señales", prerequisitos: [44, 45, 40, 41] },
              { id: 52, nombre: "Interacción HD-SW", prerequisitos: [44, 45, 42, 43] },
              { id: 53, nombre: "Electrónica Industrial", prerequisitos: [44, 45] },
              { id: 54, nombre: "Lab. Electrónica Industrial", prerequisitos: [44, 45] },
            ],
          },
          {
            semestre: "8º Semestre",
            materias: [
              { id: 58, nombre: "Diseño de Sistemas de Control", prerequisitos: [30, 31] },
              { id: 59, nombre: "Lab. Diseño de Sistemas de Control", prerequisitos: [30, 31] },
              { id: 60, nombre: "Micro y Nano Tecnología", prerequisitos: [50, 51] },
              { id: 61, nombre: "Lab. Micro y Nano Tecnología", prerequisitos: [50, 51] },
              { id: 62, nombre: "Redes Industriales", prerequisitos: [50, 51, 53, 54] },
              { id: 63, nombre: "Lab. Redes Industriales", prerequisitos: [50, 51, 53, 54] },
              { id: 64, nombre: "Diseño Mecatrónico", prerequisitos: [46, 47, 48, 49, 50, 51] },
              { id: 65, nombre: "Taller Diseño Mecatrónico", prerequisitos: [46, 47, 48, 49, 50, 51] },
              { id: 66, nombre: "TRABAJO DE TITULACIÓN", prerequisitos: [58, 59, 60, 61, 62, 63, 64, 65] },
            ],
          },
        ],
      },
    };

    const carreraSelect = document.getElementById("carrera-select");
    const materiasAprobadasSection = document.getElementById("materias-aprobadas");
    const accordionSemestres = document.getElementById("accordionSemestres");
    const checkAvailableButton = document.getElementById("check-available");
    const availableList = document.getElementById("available-list");
    const materiasDisponiblesSection = document.getElementById("materias-disponibles");
    const horarioSection = document.getElementById("horario-section");

    let materias = [];
    let availableMaterias = [];
    let checkedMaterias = new Set(); // Usamos un Set para llevar registro de materias aprobadas
    const days = ['Hora', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
    const hours = ['7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00'];

    // Función para mostrar tooltip con las correlativas
    function setupTooltips() {
      const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    }

    // Función para marcar/desmarcar todas las materias de un semestre
    function toggleAllMaterias(semestreIndex, check) {
      const semestreContainer = document.getElementById(`collapse-semestre-${semestreIndex}`);
      const checkboxes = semestreContainer.querySelectorAll('input[type="checkbox"]');

      checkboxes.forEach(checkbox => {
        checkbox.checked = check;
        const materiaId = parseInt(checkbox.value);

        if (check) {
          checkedMaterias.add(materiaId);
        } else {
          checkedMaterias.delete(materiaId);
        }

        // Actualizar estado visual de las materias
        updateMateriaState(checkbox);
      });

      // Actualizar materias disponibles
      updateAvailableCourses();
    }

    // Función para actualizar el estado visual de una materia
    function updateMateriaState(checkbox) {
      const materiaId = parseInt(checkbox.value);
      const materiaItem = checkbox.closest('.materia-item');
      const prerequisitosList = materiaItem.querySelector('.prerequisitos-list');

      if (!prerequisitosList) return;

      // Verificar si se cumplen los prerequisitos
      const materia = materias.find(m => m.id === materiaId);
      const prerequisitosCumplidos = materia.prerequisitos.every(req => checkedMaterias.has(req));

      // Actualizar clases según estado
      if (prerequisitosCumplidos) {
        materiaItem.classList.remove('materia-disabled');
        checkbox.disabled = false;
      } else {
        materiaItem.classList.add('materia-disabled');
        checkbox.disabled = true;
        checkbox.checked = false;
        checkedMaterias.delete(materiaId);
      }

      // Actualizar lista de prerequisitos
      prerequisitosList.innerHTML = materia.prerequisitos.map(req => {
        const materiaReq = materias.find(m => m.id === req);
        const cumple = checkedMaterias.has(req);
        return `<li class="prerequisito-item ${cumple ? 'prerequisito-cumplido' : 'prerequisito-pendiente'}">
          ${materiaReq ? materiaReq.nombre : `Materia ${req}`}
          ${cumple ? '✓' : '✗'}
        </li>`;
      }).join('');
    }

    // Función para actualizar las materias disponibles
    function updateAvailableCourses() {
      availableMaterias = materias.filter(materia => {
        return (
          !checkedMaterias.has(materia.id) &&
          materia.prerequisitos.every(req => checkedMaterias.has(req))
        );
      });

      displayAvailableCourses(availableMaterias);
    }
    // Mostrar materias por semestre con botón de "Marcar todas"
    carreraSelect.addEventListener("change", () => {
      const carrera = planes[carreraSelect.value];
      if (!carrera) return;

      materias = carrera.semestres.flatMap((s) => s.materias);
      checkedMaterias.clear();
      accordionSemestres.innerHTML = "";

      carrera.semestres.forEach((semestre, index) => {
        const idAcordeon = `semestre-${index}`;
        const card = `
          <div class="accordion-item">
            <h2 class="accordion-header" id="heading-${idAcordeon}">
              <div class="semestre-header w-100 pe-3">
                <button class="accordion-button ${index !== 0 ? "collapsed" : ""}" type="button" 
                  data-bs-toggle="collapse" data-bs-target="#collapse-${idAcordeon}" 
                  aria-expanded="${index === 0}" aria-controls="collapse-${idAcordeon}">
                  ${semestre.semestre}
                </button>
                <button class="select-all-btn btn btn-sm btn-outline-primary" 
                  onclick="toggleAllMaterias(${index}, true)">
                  Marcar todas
                </button>
                <button class="select-all-btn btn btn-sm btn-outline-secondary ms-1" 
                  onclick="toggleAllMaterias(${index}, false)">
                  Desmarcar
                </button>
              </div>
            </h2>
            <div id="collapse-${idAcordeon}" class="accordion-collapse collapse ${index === 0 ? "show" : ""}" 
              aria-labelledby="heading-${idAcordeon}" data-bs-parent="#accordionSemestres">
              <div class="accordion-body">
                ${semestre.materias
            .map(materia => `
                    <div class="materia-item" data-materia-id="${materia.id}">
                      <div class="form-check">
                        <input class="form-check-input materia-checkbox" type="checkbox" 
                          id="materia-${materia.id}" value="${materia.id}"
                          onchange="handleMateriaCheckboxChange(this)">
                        <label class="form-check-label" for="materia-${materia.id}">
                          ${materia.nombre}
                        </label>
                        <div class="correlativas-info">
                          <small class="text-muted">Correlativas:</small>
                          <ul class="prerequisitos-list">
                            ${materia.prerequisitos.map(req => {
              const materiaReq = materias.find(m => m.id === req);
              return `<li class="prerequisito-item prerequisito-pendiente">
                                ${materiaReq ? materiaReq.nombre : `Materia ${req}`} ✗
                              </li>`;
            }).join('')}
                          </ul>
                        </div>
                      </div>
                    </div>
                  `).join('')}
              </div>
            </div>
          </div>
        `;
        accordionSemestres.insertAdjacentHTML("beforeend", card);
      });

      // Inicializar tooltips y estados de materias
      setupTooltips();
      materiasAprobadasSection.style.display = "block";
      materiasDisponiblesSection.style.display = "none";
      horarioSection.style.display = "none";
    });

    // Manejar cambios en los checkboxes de materias
    function handleMateriaCheckboxChange(checkbox) {
      const materiaId = parseInt(checkbox.value);

      if (checkbox.checked) {
        checkedMaterias.add(materiaId);
      } else {
        checkedMaterias.delete(materiaId);
      }

      // Actualizar estado de todas las materias que dependan de esta
      updateAllMateriasStates();
      // Actualizar materias disponibles
      updateAvailableCourses();
    }

    // Actualizar el estado de todas las materias
    function updateAllMateriasStates() {
      document.querySelectorAll('.materia-checkbox').forEach(checkbox => {
        updateMateriaState(checkbox);
      });
    }

    // Generar el horario
    function generateSchedule() {
      const schedule = document.getElementById('schedule');
      schedule.innerHTML = '';

      // Crear encabezados de días
      days.forEach(day => {
        const cell = document.createElement('div');
        cell.className = 'schedule-cell schedule-header';
        cell.textContent = day;
        schedule.appendChild(cell);
      });

      // Crear celdas de horas
      hours.forEach(hour => {
        // Celda de hora
        const timeCell = document.createElement('div');
        timeCell.className = 'schedule-cell schedule-header';
        timeCell.textContent = hour;
        schedule.appendChild(timeCell);

        // Celdas para cada día
        for (let i = 1; i < days.length; i++) {
          const cell = document.createElement('div');
          cell.className = 'schedule-cell';
          cell.dataset.time = hour;
          cell.dataset.day = days[i];
          schedule.appendChild(cell);
        }
      });

      // Configurar eventos de arrastre para las celdas del horario
      setupDropZones();
    }
    document.getElementById('download-image').addEventListener('click', function () {
      const schedule = document.getElementById('schedule');

      html2canvas(schedule).then(canvas => {
        const link = document.createElement('a');
        link.download = 'mi-horario.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    });
    // Mostrar materias disponibles como elementos arrastrables
    function displayAvailableCourses(courses) {
      availableList.innerHTML = "";

      if (courses.length === 0) {
        availableList.innerHTML = "<li class='list-group-item'>No hay materias disponibles por ahora.</li>";
      } else {
        courses.forEach((materia) => {
          const li = document.createElement('li');
          li.className = 'list-group-item draggable-course';
          li.textContent = materia.nombre;
          li.draggable = true;
          li.dataset.course = JSON.stringify(materia);

          li.addEventListener('dragstart', function (e) {
            e.dataTransfer.setData('text/plain', this.dataset.course);
            this.classList.add('dragging');
          });

          li.addEventListener('dragend', function () {
            this.classList.remove('dragging');
          });

          // Tooltip con información de la materia
          li.setAttribute('data-bs-toggle', 'tooltip');
          li.setAttribute('data-bs-placement', 'top');
          li.setAttribute('title', `Correlativas: ${materia.prerequisitos.length > 0 ?
            materia.prerequisitos.map(req => {
              const materiaReq = materias.find(m => m.id === req);
              return materiaReq ? materiaReq.nombre : `Materia ${req}`;
            }).join(', ') :
            'Ninguna'
            }`);

          availableList.appendChild(li);
        });

        // Inicializar tooltips para las materias disponibles
        setupTooltips();
      }
    }

    // Configurar zonas donde se pueden soltar las materias
    function setupDropZones() {
      document.querySelectorAll('.schedule-cell:not(.schedule-header)').forEach(cell => {
        cell.addEventListener('dragover', function (e) {
          e.preventDefault();
          this.classList.add('drop-hover');
        });

        cell.addEventListener('dragleave', function () {
          this.classList.remove('drop-hover');
        });

        cell.addEventListener('drop', function (e) {
          e.preventDefault();
          this.classList.remove('drop-hover');

          const courseData = e.dataTransfer.getData('text/plain');
          if (courseData) {
            try {
              const course = JSON.parse(courseData);
              placeCourseInCell(this, course);
            } catch (error) {
              console.error('Error al procesar los datos del curso:', error);
            }
          }
        });
      });
    }

    // Colocar un curso en una celda específica
    function placeCourseInCell(cell, course) {
      // Verificar si ya existe el curso en esta celda
      const existingCourse = cell.querySelector(`.course-block[data-course="${course.id}"]`);
      if (existingCourse) return;

      // Limpiar conflictos previos
      cell.classList.remove('conflict');

      // Crear el bloque del curso
      const courseDiv = document.createElement('div');
      courseDiv.className = 'course-block';
      courseDiv.textContent = course.nombre;
      courseDiv.dataset.course = course.id;
      courseDiv.draggable = true;

      // Botón para eliminar
      const deleteBtn = document.createElement('span');
      deleteBtn.className = 'course-delete';
      deleteBtn.innerHTML = '×';
      deleteBtn.addEventListener('click', function (e) {
        e.stopPropagation();
        courseDiv.remove();
        checkForConflicts();
      });

      courseDiv.appendChild(deleteBtn);
      cell.appendChild(courseDiv);

      // Verificar choques
      checkForConflicts();
    }

    // Verificar choques de horario
    function checkForConflicts() {
      // Limpiar conflictos anteriores
      document.querySelectorAll('.conflict').forEach(el => {
        el.classList.remove('conflict');
      });

      let hasConflicts = false;
      const allCells = document.querySelectorAll('.schedule-cell:not(.schedule-header)');

      allCells.forEach(cell => {
        if (cell.children.length > 1) {
          hasConflicts = true;
          cell.classList.add('conflict');
          Array.from(cell.children).forEach(child => {
            child.classList.add('conflict');
          });
        }
      });

      return hasConflicts;
    }

    // Funcionalidad para agregar cursos manualmente
    document.getElementById('add-course').addEventListener('click', () => {
      const courseName = prompt("Nombre de la materia:");
      if (courseName) {
        const courseDays = prompt("Días (ej. Lunes,Martes):").split(',');
        const courseTime = prompt("Hora de inicio (ej. 8:00):");
        const duration = parseInt(prompt("Duración (en horas):", "2")) || 2;

        const course = {
          id: Date.now(), // ID temporal
          nombre: courseName,
          days: courseDays.map(day => day.trim()),
          time: courseTime,
          duration: duration
        };

        // Colocar en todas las celdas correspondientes
        course.days.forEach(day => {
          const timeIndex = hours.indexOf(course.time);
          if (timeIndex !== -1) {
            for (let i = 0; i < course.duration; i++) {
              const currentHour = hours[timeIndex + i];
              const cell = document.querySelector(`.schedule-cell[data-day="${day}"][data-time="${currentHour}"]`);
              if (cell) {
                placeCourseInCell(cell, course);
              }
            }
          }
        });
      }
    });

    // Verificar choques de horario
    document.getElementById('check-conflicts').addEventListener('click', () => {
      const hasConflicts = checkForConflicts();

      if (hasConflicts) {
        alert("¡Hay choques en tu horario! Las celdas en rojo indican conflictos.");
      } else {
        alert("No hay choques en tu horario. ¡Todo está bien!");
      }
    });

    // Limpiar horario
    document.getElementById('clear-schedule').addEventListener('click', () => {
      if (confirm("¿Estás seguro de que quieres limpiar todo el horario?")) {
        document.querySelectorAll('.schedule-cell:not(.schedule-header)').forEach(cell => {
          cell.innerHTML = '';
        });
      }
    });

    // Calcular materias disponibles
    checkAvailableButton.addEventListener("click", () => {
      updateAvailableCourses();
      materiasDisponiblesSection.style.display = "block";
      horarioSection.style.display = "block";
      generateSchedule();
    });

    // Hacer funciones accesibles globalmente para los botones
    window.toggleAllMaterias = toggleAllMaterias;
    window.handleMateriaCheckboxChange = handleMateriaCheckboxChange;
    // Función para configurar la calculadora de notas
    function setupCalculadoraNotas() {
      const materiaNotasSelect = document.getElementById("materia-notas-select");
      const configEvaluacionContainer = document.getElementById("config-evaluacion-container");
      const btnCalcularNota = document.getElementById("btn-calcular-nota");
      const resultadosNotas = document.getElementById("resultados-notas");
      const detalleCalculadora = document.getElementById("detalle-calculadora");

      // Llenar select de materias
      materiaNotasSelect.innerHTML = '<option value="" disabled selected>Elige una materia</option>' +
        materias.map(m => `<option value="${m.id}">${m.nombre}</option>`).join('');

      // Event listeners para mostrar/ocultar secciones
      document.getElementById("tiene-final").addEventListener("change", function () {
        const finalContainer = document.getElementById("final-container");
        finalContainer.style.display = this.value === "no" ? "none" : "block";

        const recuperatorioContainer = document.getElementById("recuperatorio-container");
        recuperatorioContainer.style.display = this.value === "recuperatorio" ? "block" : "none";

        if (this.value === "recuperatorio") {
          actualizarOpcionesRecuperatorio();
        }
      });

      document.getElementById("tiene-practicas").addEventListener("change", function () {
        document.getElementById("practicas-container").style.display = this.value === "si" ? "block" : "none";
      });

      document.getElementById("tiene-auxiliatura").addEventListener("change", function () {
        document.getElementById("auxiliatura-container").style.display = this.value === "si" ? "block" : "none";
      });

      document.getElementById("num-parciales").addEventListener("change", function () {
        generarCamposParciales(parseInt(this.value));
        if (document.getElementById("tiene-final").value === "recuperatorio") {
          actualizarOpcionesRecuperatorio();
        }
      });

      // Generar campos iniciales
      generarCamposParciales(2);

      // Configurar evento para calcular notas
      btnCalcularNota.addEventListener("click", calcularNotaNecesaria);

      function actualizarOpcionesRecuperatorio() {
        const numParciales = parseInt(document.getElementById("num-parciales").value);
        const select = document.getElementById("parcial-recupera");
        select.innerHTML = '';

        for (let i = 1; i <= numParciales; i++) {
          select.innerHTML += `<option value="${i}">Parcial ${i}</option>`;
        }
      }

      function generarCamposParciales(numParciales) {
        const container = document.getElementById("parciales-container");
        container.innerHTML = '';

        for (let i = 1; i <= numParciales; i++) {
          container.innerHTML += `
        <div class="row mb-2">
          <div class="col-md-6">
            <label class="form-label">Peso Parcial ${i} (%)</label>
            <input type="number" id="peso-parcial-${i}" class="form-control peso-parcial" min="0" max="100" value="${i === 1 ? 30 : 20}">
          </div>
          <div class="col-md-6">
            <label class="form-label">Nota Obtenida Parcial ${i} (opcional)</label>
            <input type="number" id="nota-parcial-${i}" class="form-control nota-parcial" min="0" max="100" placeholder="Dejar vacío si no presentado">
          </div>
        </div>
      `;
        }
      }

      function calcularNotaNecesaria() {
        const numParciales = parseInt(document.getElementById("num-parciales").value);
        const tieneFinal = document.getElementById("tiene-final").value;
        const tienePracticas = document.getElementById("tiene-practicas").value === "si";
        const tieneAuxiliatura = document.getElementById("tiene-auxiliatura").value === "si";
        const notaMinima = parseFloat(document.getElementById("nota-minima").value);

        // Calcular pesos
        let pesoParciales = 0;
        let pesoFinal = 0;
        let pesoPracticas = 0;
        let pesoAuxiliatura = 0;

        // Obtener pesos de parciales
        const pesosParciales = [];
        for (let i = 1; i <= numParciales; i++) {
          const peso = parseFloat(document.getElementById(`peso-parcial-${i}`).value);
          pesosParciales.push(peso);
          pesoParciales += peso;
        }

        if (tieneFinal !== "no") {
          pesoFinal = parseFloat(document.getElementById("peso-final").value);
        }

        if (tienePracticas) {
          pesoPracticas = parseFloat(document.getElementById("peso-practicas").value);
        }

        if (tieneAuxiliatura) {
          pesoAuxiliatura = parseFloat(document.getElementById("peso-auxiliatura").value);
        }

        // Validar que la suma de pesos sea 100%
        const sumaPesos = pesoParciales + pesoFinal + pesoPracticas + pesoAuxiliatura;
        if (sumaPesos !== 100) {
          resultadosNotas.innerHTML = `
        <div class="alert alert-danger">
          Error: La suma de los porcentajes debe ser 100% (actual: ${sumaPesos}%)
        </div>
      `;
          return;
        }

        // Obtener notas ingresadas
        const notasParciales = [];
        for (let i = 1; i <= numParciales; i++) {
          const nota = document.getElementById(`nota-parcial-${i}`).value;
          notasParciales.push(nota ? parseFloat(nota) : null);
        }

        const notaPracticas = tienePracticas && document.getElementById("nota-practicas").value ?
          parseFloat(document.getElementById("nota-practicas").value) : null;

        const notaAuxiliatura = tieneAuxiliatura && document.getElementById("nota-auxiliatura").value ?
          parseFloat(document.getElementById("nota-auxiliatura").value) : null;

        // Calcular nota actual y necesaria
        let notaActual = 0;
        let notaNecesaria = 0;
        let detalle = "<h6>Detalle de Cálculo</h6><ul>";
        let pesoRestante = 100;

        // Calcular contribución de parciales
        for (let i = 0; i < numParciales; i++) {
          if (notasParciales[i] !== null) {
            const contribucion = notasParciales[i] * pesosParciales[i] / 100;
            notaActual += contribucion;
            pesoRestante -= pesosParciales[i];
            detalle += `<li>Parcial ${i + 1}: ${notasParciales[i]} (${pesosParciales[i]}%) → ${contribucion.toFixed(2)}</li>`;
          }
        }

        // Manejar recuperatorio
        if (tieneFinal === "recuperatorio") {
          const parcialARecuperar = parseInt(document.getElementById("parcial-recupera").value) - 1;
          if (notasParciales[parcialARecuperar] !== null) {
            detalle += `<li>El final reemplaza al Parcial ${parcialARecuperar + 1}</li>`;
          }
        }

        // Calcular contribución de prácticas
        if (tienePracticas && notaPracticas !== null) {
          const contribucion = notaPracticas * pesoPracticas / 100;
          notaActual += contribucion;
          pesoRestante -= pesoPracticas;
          detalle += `<li>Prácticas: ${notaPracticas} (${pesoPracticas}%) → ${contribucion.toFixed(2)}</li>`;
        }

        // Calcular contribución de auxiliatura
        if (tieneAuxiliatura && notaAuxiliatura !== null) {
          const contribucion = notaAuxiliatura * pesoAuxiliatura / 100;
          notaActual += contribucion;
          pesoRestante -= pesoAuxiliatura;
          detalle += `<li>Auxiliatura: ${notaAuxiliatura} (${pesoAuxiliatura}%) → ${contribucion.toFixed(2)}</li>`;
        }

        // Calcular nota necesaria en los componentes restantes
        if (pesoRestante > 0) {
          notaNecesaria = (notaMinima - notaActual) * 100 / pesoRestante;
          notaNecesaria = Math.max(0, Math.min(100, notaNecesaria)); // Asegurar entre 0 y 100

          detalle += `<li>Nota actual: ${notaActual.toFixed(2)}</li>`;

          if (tieneFinal === "recuperatorio") {
            const parcialARecuperar = parseInt(document.getElementById("parcial-recupera").value);
            detalle += `<li>Necesitas ${notaNecesaria.toFixed(2)} en el final (recupera Parcial ${parcialARecuperar}) para alcanzar ${notaMinima}</li>`;
          } else if (tieneFinal === "si") {
            detalle += `<li>Necesitas ${notaNecesaria.toFixed(2)} en el final (${pesoFinal}%) para alcanzar ${notaMinima}</li>`;
          } else {
            detalle += `<li>Necesitas ${notaNecesaria.toFixed(2)} en el resto (${pesoRestante}%) para alcanzar ${notaMinima}</li>`;
          }
        } else {
          notaNecesaria = 0;
          detalle += `<li>Nota final: ${notaActual.toFixed(2)}</li>`;
        }

        detalle += "</ul>";

        // Mostrar resultados
        let resultadoHTML = '';
        if (notaActual >= notaMinima) {
          resultadoHTML = `
        <div class="alert alert-success">
          <h5>¡Ya estás aprobado!</h5>
          <p>Tu nota actual es ${notaActual.toFixed(2)} (sobre ${notaMinima} requeridos)</p>
        </div>
      `;
        } else if (pesoRestante > 0) {
          let mensaje = '';
          if (tieneFinal === "recuperatorio") {
            const parcialARecuperar = parseInt(document.getElementById("parcial-recupera").value);
            mensaje = `Necesitas ${notaNecesaria.toFixed(2)} en el final (recupera Parcial ${parcialARecuperar})`;
          } else if (tieneFinal === "si") {
            mensaje = `Necesitas ${notaNecesaria.toFixed(2)} en el examen final`;
          } else {
            mensaje = `Necesitas ${notaNecesaria.toFixed(2)} en los componentes restantes`;
          }

          resultadoHTML = `
        <div class="alert ${notaNecesaria <= 70 ? 'alert-warning' : 'alert-danger'}">
          <h5>${mensaje}</h5>
          <p>Nota actual: ${notaActual.toFixed(2)}/${notaMinima}</p>
          <p>Peso restante: ${pesoRestante}%</p>
        </div>
      `;
        } else {
          resultadoHTML = `
        <div class="alert alert-danger">
          <h5>No hay más evaluaciones disponibles</h5>
          <p>Tu nota final es ${notaActual.toFixed(2)} (requieres ${notaMinima})</p>
        </div>
      `;
        }

        resultadosNotas.innerHTML = resultadoHTML;
        detalleCalculadora.innerHTML = detalle;
      }
    }

    // Activar calculadora cuando se selecciona una carrera
    carreraSelect.addEventListener("change", () => {
      document.getElementById("calculadora-notas").style.display = "block";
      setupCalculadoraNotas();
    });
  </script>
</body>

</html>